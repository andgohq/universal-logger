{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["import pino from 'pino';\nimport chalkModule from 'chalk';\nimport dayjs from 'dayjs';\n\nexport type Level = 'debug' | 'fatal' | 'error' | 'warn' | 'info' | 'trace';\nexport type StatusType = 'error' | 'warn' | 'info' | 'debug';\nexport type LogFn = pino.LogFn;\nexport type ExternalLoggerType = (opts: {\n  message: string;\n  context?: Record<string, any>;\n  status?: StatusType;\n}) => void;\n\nexport interface AGLogger {\n  fatal: LogFn;\n  error: LogFn;\n  warn: LogFn;\n  info: LogFn;\n  debug: LogFn;\n  child: (params: Record<string, any>) => AGLogger;\n}\n\nexport const NO_OPS_LOGGER: ExternalLoggerType = () => {};\n\nconst DEFAULT_MASK_LENGTH = 8;\nconst DEFAULT_CHALK_LEVEL = 1;\n\nconst LEVEL_TO_CONSOLE: Record<Level, StatusType> = {\n  debug: 'debug',\n  fatal: 'info',\n  error: 'info', // use info to disable stack trace\n  warn: 'info', // use info to disable stack trace\n  info: 'info',\n  trace: 'info',\n};\n\nconst LEVEL_TO_LABEL: Record<Level, string> = {\n  debug: 'D',\n  fatal: 'F',\n  error: 'E',\n  warn: 'W',\n  info: 'I',\n  trace: 'I',\n};\n\nlet chalk = new chalkModule.Instance({ level: DEFAULT_CHALK_LEVEL });\nlet PRESENT_EXTERNAL_LOGGER = NO_OPS_LOGGER;\n\nconst OPTIONS = {\n  level: (process.env.LOG_LEVEL ?? 'debug') as Level,\n  context: {} as Record<string, any>,\n  maskTargets: [] as string[],\n  maskFunc: (s: string) => `${s.substring(0, DEFAULT_MASK_LENGTH)}***`,\n  enableStack: true,\n  browser: {\n    inline: false,\n  },\n};\n\nexport const updateOptions = (options: Partial<typeof OPTIONS>) => {\n  Object.assign(OPTIONS, options);\n};\n\nexport function setExternalLogger(logger: ExternalLoggerType) {\n  PRESENT_EXTERNAL_LOGGER = logger;\n}\n\nexport const setColorLevel = (level: chalkModule.Level) => {\n  chalk = new chalkModule.Instance({ level });\n};\n\nconst serializer = (k: string, v: any) => {\n  const isMaskTarget =\n    OPTIONS.maskTargets.findIndex((ele) => ele === k) >= 0 && (typeof v === 'string' || typeof v === 'number');\n\n  if (isMaskTarget) {\n    return OPTIONS.maskFunc(`${v}`);\n  } else {\n    return v;\n  }\n};\n\nconst transform = (obj: Record<string, any>) => {\n  return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k, serializer(k, v)]));\n};\n\nconst pickExists = (obj: Record<string, any>) => {\n  return Object.fromEntries(Object.entries(obj).filter(([, v]) => v !== undefined));\n};\n\nconst summarize = (obj: Record<string, any>) => {\n  // omit stack, level, time, msg from the parameter object\n  const { type, message, stack, err, msg, method, ...rest } = obj as {\n    // properties when the object is Error instance\n    // error style 1\n    type?: 'Error';\n    message?: string; // exist when logger.error is used\n    stack?: string; // exist when logger.error is used\n    // error style 2\n    err?: Error;\n    // standard properties\n    msg?: string;\n    method?: string;\n  };\n\n  const isErrorMode = (type == 'Error' && stack) || err;\n  const finalMsg = (isErrorMode ? msg ?? message ?? err?.message : msg) ?? '';\n  const finalParams = {\n    ...transform(rest),\n    ...(isErrorMode && OPTIONS.enableStack\n      ? { stack: (stack ?? err?.stack ?? '').split('\\n') }\n      : pickExists({ type, message, stack })),\n  };\n\n  return { msg: finalMsg, method, ...finalParams };\n};\n\nexport const logFactory = (name: string): AGLogger =>\n  pino({\n    name,\n    level: OPTIONS.level,\n    formatters: {\n      // omit pid and hostname\n      bindings: ({ name }) => ({ name }),\n      // for nodejs environment only\n      log: (o) => {\n        const { level, time, ...rest } = o as Record<string, any>;\n\n        return { level, time, ...summarize(rest) };\n      },\n    },\n    browser: {\n      // use Pino's standard serializers\n      // https://github.com/pinojs/pino-std-serializers\n      serialize: false,\n      write: (o) => {\n        const { level, time, ...rest } = o as Record<string, any>;\n        const { msg, method, ...params } = summarize(rest);\n\n        const LEVEL_TO_COLOR: Record<Level, typeof chalkModule.Instance | ((s: string) => string)> = {\n          debug: chalk.gray,\n          fatal: chalk.bgRed.white,\n          error: chalk.red,\n          warn: chalk.yellow,\n          info: (s: string) => s,\n          trace: (s: string) => s,\n        };\n\n        const color = LEVEL_TO_COLOR[pino.levels.labels[`${level}`]];\n        // get HH:mm:ss\n        const timeLabel = dayjs(time).format('HH:mm:ss');\n        const levelKey = pino.levels.labels[`${level}`] as Level;\n        const consoleKey = LEVEL_TO_CONSOLE[levelKey];\n        const levelLabel = LEVEL_TO_LABEL[levelKey];\n\n        const _method = method ? `:${method}` : '';\n        const s = `${timeLabel} ${levelLabel} [${name}${_method}] ${msg}`;\n\n        if (Object.keys(params).length) {\n          if (OPTIONS.browser.inline) {\n            console[consoleKey](color(`${s} ${JSON.stringify(params)}`));\n          } else {\n            console[consoleKey](color(s), params);\n          }\n        } else {\n          console[consoleKey](color(s));\n        }\n\n        PRESENT_EXTERNAL_LOGGER({ message: msg || '', context: { logger: name, ...params }, status: consoleKey });\n      },\n    },\n  });\n"],"names":[],"version":3,"file":"module.js.map"}